log-file=LOG.txt

#########
#  OSD  #
#########

osd-font=Nata Sans
osd-font-size=40
osd-color=0.0/0.0/0.0/1.0  			# Black text body
osd-outline-size=1.5
osd-outline-color=1.0/1.0/1.0/1.0 	# White outline
osd-blur=0.1
osd-align-x=center
osd-bar=no
osd-margin-y=50
osd-duration=3000
osd-scale-by-window=yes
script-opts=console-font_size=10

#########
# Cache #
#########

gpu-shader-cache-dir=~~/cache/shaders
icc-cache-dir=~~/cache/icc

# OPTIMIZED FOR STREAMING
cache=yes
cache-secs=900
demuxer-readahead-secs=180
demuxer-max-back-bytes=150MiB  		# Increased for better seeking
demuxer-max-bytes=300MiB  			# Increased for SVP buffering
stream-buffer-size=64MiB  			# Increased for smoother streaming
demuxer-seekable-cache=yes			# Enable seeking in cached data

# Network resilience for unstable streams
stream-lavf-o=reconnect=1,reconnect_streamed=1,reconnect_delay_max=5

########
# Subs #
########

sub-font='Nata Sans'
sub-font-size=48
sub-bold=yes
sub-border-size=0.5
sub-shadow-offset=1.3

embeddedfonts=yes
# sub-ass-override=no 				# Remove '#' if subtitle looks weird

#########################################################################
# SUBTITLE BACKGROUND CONFIGURATION:									#
#																		#
# DEFAULT: 'outline-and-shadow'											#
# - This creates an outline and a drop shadow. Color and transparency   #
# can be adjusted from within Stremio's settings for both of them.		#
# 																		#
# ENABLE 'background-box' if you want a box around the subtitle instead.#
#																		#
# To enable: Remove the '#' at the start of the 'sub-border-style' 		#
# setting below															#
#########################################################################

#sub-border-style=background-box

###########################################################################
# TOP-LEVEL BASELINE DEFAULTS
# These are the "initial values" that reset-on-next-file will reset TO.
###########################################################################

# Core rendering
gpu-api=auto
profile=high-quality
vo=gpu-next
vd-queue-enable=no

# Colorspace defaults (MINIMAL - let profile-manager.lua handle HDR/SDR specifics)
target-prim=auto
target-trc=auto
target-contrast=auto

# Deband defaults
deband=yes
deband-iterations=2         		# 1 is often too weak for low-bitrate streams
deband-threshold=35        		# Balanced to avoid blurring textures
deband-range=16
deband-grain=0

# Dither settings
dither=fruit                		# Best for 8-bit displays, works on all GPUs
dither-depth=10  			# Explicitly set to 10 for high-precision pipeline. GPU driver will downsample correctly for 8-bit
temporal-dither=yes          		# Reduces visible dither patterns over time 
temporal-dither-period=1     		# Change pattern every frame (fastest cycling)

# Scaling defaults
scale=spline36             		# Fast and sharp for all GPUs
cscale=lanczos             		# Standard high-quality chroma
dscale=mitchell             		# Clean downscaling
scale-antiring=0.7
cscale-antiring=0.7
dscale-antiring=0.7
sigmoid-upscaling=yes			# Prevents ringing/aliasing artifacts during upscaling
linear-downscaling=no
correct-downscaling=yes

############################## PROFILES ##############################
# Profiles OVERRIDE the baseline above. They use -clr then -append for lists.
######################################################################

[sdr]
# osd-playing-msg=• Cinema •# : ${media-title}

# Cinematic Audio (Audiophile)
# - Target: EBU R128 (-16 LUFS for Home Theater)
# - LRA=20: Retains THEATRICAL dynamic range (Preserves quiet whispers & loud explosions)
# - TP=-1.5: Safe True Peak ceiling
# af-append=@CINEMA:lavfi=[loudnorm=I=-16:TP=-1.5:LRA=20]

# Scaling optimized for live-action
scale=spline36
cscale=mitchell

###########################################################################

[anime-sdr]
# osd-playing-msg=• Anime •# : ${media-title}

# Anime Audio (Fidelity)
# - Target: EBU R128 (-16 LUFS for seamless switching)
# - LRA=15: Moderate dynamic range (Balanced for clearer dialogue vs SFX)
# - No EQ/Filtering: Preserves original sound design
# af-append=@ANIME:lavfi=[loudnorm=I=-16:TP=-1.5:LRA=15]

# Decoder Settings - CRITICAL FOR STREAMING + SVP
hwdec=auto-copy						# Copy decoded frames to RAM for VapourSynth/SVP access
hr-seek-framedrop=no                # Critical for SVP — prevents desync after seeks / during init
video-latency-hacks=yes             # Reduces initial buffering / waiting, helps heavy filter chains start faster
mc=0                                # Disables A/V timestamp "magic correction" that sometimes fights SVP
autosync=30                         # Stabilize startup A/V sync (helps heavy filter initialization)

# Video Queue - for streaming stability with SVP
vd-queue-enable=yes
vd-queue-max-bytes=512MiB
vd-queue-max-samples=35
vd-queue-max-secs=60

# Scaling
scale=ewa_lanczos
cscale=ewa_lanczos
scale-radius=3.2384
scale-blur=1.05

# This targets gradients specifically without blurring line art.
deband-iterations=2    			    # Range 1-4. 2 is the sweet spot for performance/quality.
deband-threshold=45    			    # Strength. 45 is high enough for most anime banding.
deband-range=16      			  	# How far the filter looks for bands.
deband-grain=20      

# NOTE: Shaders, VF chains (hqdn3d + SVP), and HDR handling are now applied
# dynamically by profile-manager.lua based on content type and user settings.
#
# Shader presets available:
#   - optimized: Anime4K Optimized+ (Smart Skip) for 4K on Low-End
#   - fast: Anime4K Eye Candy (Fast)
#   - hq: Anime4K Eye Candy (HQ)
#
# VF chains:
#   - Standard: hqdn3d + SVP
#   - Legacy (interlaced ≤576p): BWDIF + SVP (no hqdn3d)

###########################################################################
