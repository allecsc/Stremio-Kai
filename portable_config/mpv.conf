log-file=LOG.txt

#########
# Cache #
#########

# Optimized for i5-9300H + 16GB RAM
cache=yes
cache-secs=900  					# Reduced from 1800 for SVP efficiency
demuxer-max-back-bytes=75MiB  		# Increased for better seeking
demuxer-max-bytes=150MiB  			# Increased for SVP buffering
stream-buffer-size=16MiB  			# Increased for smoother streaming
gpu-shader-cache-dir=~~/cache/shaders
icc-cache-dir=~~/cache/icc

########
# Subs #
########

sub-font="~~/fonts/NataSans-Regular.ttf"
sub-border-size=0.1
sub-outline-color=0.0/0.0/0.0/0.0  	# fully transparent
sub-shadow-offset=2.0     	  		# Small subtle drop shadow
sub-shadow-color=0.0/0.0/0.0/0.75  	# Semi-transparent black shadow
sub-blur=0.3             
sub-align-x=center
sub-align-y=bottom

#########
# Audio #
#########

ao=wasapi
audio-exclusive=no
audio-format=float  				# Better than s32 for modern systems
audio-pitch-correction=yes

# Universal audio filter chain
# af-append=lavfi=[loudnorm=I=-16:TP=-3:LRA=4,acompressor=threshold=0.0625:ratio=2.5:attack=50:release=300:makeup=1,highpass=f=80,lowpass=f=16000]

###########
# GPU API #
###########

gpu-api=vulkan
vulkan-async-compute=yes
vulkan-async-transfer=yes
vulkan-queue-count=1  				# Single queue for GTX 1650

##################
# Video Settings #
##################

profile=high-quality
vo=gpu-next
hwdec=auto
hwdec-codecs=all

# Optimized for i5-9300H (4 cores/8 threads) + GTX 1650
vd-lavc-threads=0  					# Let FFmpeg auto-detect (better than fixed 4)
vd-lavc-dr=yes

deband=no

# Dither optimized for gpu-next
dither=fruit
dither-depth=auto
temporal-dither-period=1

# Better scaling and antiring
scale-antiring=0.7
cscale-antiring=0.7
dscale-antiring=0.7
correct-downscaling=yes
sigmoid-upscaling=yes				# Prevents ringing/aliasing artifacts during upscaling.

# Colors - Universal compatibility
video-output-levels=auto
target-contrast=auto
gamma=0
brightness=0
contrast=0
saturation=0

#########################################################################
# ICC PROFILE CONFIGURATION:
#
# Default: DISABLED for broader compatibility
# - Most users have uncalibrated displays where ICC makes colors washed out
# - Gaming monitors especially benefit from ICC being disabled
# 
# ENABLE ICC if you have:
# - A professionally calibrated monitor
# - An OLED display (usually handles ICC well)
# - Prefer color accuracy over vibrant colors
#
# To enable: Change "icc-profile-auto=no" to "icc-profile-auto=yes" below
#########################################################################

icc-profile-auto=no					# Disabled by default, try out and see if you like it
									# I use it on my OLED TV, but not on my PC monitor

# OSD
osd-font=JetBrains Mono
osd-font-size=25
osd-color=0.0/0.0/0.0/1.0  			# Black text body
osd-outline-size=1.5
osd-outline-color=1.0/1.0/1.0/1.0 	# White outline
osd-blur=0.1
osd-align-x=center
osd-bar=no
osd-margin-y=80
osd-duration=3000
osd-scale-by-window=yes
script-opts=console-font_size=10

# Playback optimizations
force-seekable=yes
hr-seek-framedrop=no
interpolation=no  					# Disabled since we use SVP
#video-sync=display-resample  		# Better frame timing, but forces FPS to match your display
									# Disabled for more control through SVP

############################## PROFILES ##############################

[anime-base]

glsl-shaders-clr
vf-clr

# Audio Filter for Anime
# - gentle loudness normalization
# - mild compression 
# - removes sub-bass rumble, keeps small impact sounds 
# - preserves high-frequency detail

af-append=lavfi=[loudnorm=I=-16:TP=-1:LRA=6,acompressor=threshold=0.0625:ratio=2:attack=20:release=200:makeup=1.2,highpass=f=60,lowpass=f=18000]

# Enhanced scaling
scale=ewa_lanczos
scale-radius=3.2239449
scale-blur=0.981251
dscale=mitchell
cscale=ewa_lanczos
correct-downscaling=yes
linear-downscaling=no

# Colors							# optional: subtle color "pop"
target-prim=auto 
target-trc=gamma2.2
gamma=-2
brightness=-2
contrast=-2
saturation=2

# Anime-specific optimizations
hwdec=auto-copy						# Enable hardware decoding for better SVP performance
temporal-dither=yes  				# Better with Anime4K
video-reversal-buffer=100000000 	# Reduced for SVP efficiency
vd-queue-enable=yes
vd-queue-max-bytes=768MiB  			# Reduced from 1536MiB for SVP
vd-queue-max-samples=30 			# Reduced from 60
vd-queue-max-secs=60 				# Reduced from 900

# Debanding optimized for anime - DISABLED by default - didn't see any improvements
#deband=yes            	 			# reduce banding in flat anime gradients
#deband-iterations=2     			# anime benefits from more iterations
#deband-threshold=32     			# good for flat anime gradients  
#deband-range=16         			# larger range for anime's gradient areas
#deband-grain=24         			# add grain to hide remaining artifacts

# Anime4k: Optimized for 4K Displays on Low-End Specs
glsl-shaders="~~/shaders/Anime4K_Clamp_Highlights.glsl;~~/shaders/Anime4K_Restore_CNN_M.glsl;~~/shaders/Anime4K_Upscale_CNN_x2_M.glsl;~~/shaders/Anime4K_Upscale_Denoise_CNN_x2_M.glsl;~~/shaders/Anime4K_AutoDownscalePre_x2.glsl;~~/shaders/Anime4K_Thin_Fast.glsl;~~/shaders/Anime4K_Thin_VeryFast.glsl"

# SVP Frame Rate Conversion Optimized for 48 FPS
vf=@SVP:vapoursynth="~~/svp_main.vpy":buffered-frames=8:concurrent-frames=8

###########################################################################

[movies-tv]

glsl-shaders-clr
vf-clr

# Cinematic Audio Filter for Movies & TV
# - moderate loudness normalization 
# - gentle but noticeable compression 
# - allows deeper bass for cinematic impact 
# - keeps full high end 
# - slight low-end boost for cinematic feel 
# - slight high-end boost

af-append=lavfi=[highpass=f=40,bass=g=3:f=100:t=s,acompressor=ratio=2:threshold=0.125:makeup=2,equalizer=f=3000:t=q:w=1.5:g=2]

# hwdec=auto-copy					# Enable this only if you plan to use any vf for movies

# Scaling optimized for live-action
scale=spline36
cscale=mitchell

############################## AUTO PROFILES ##############################

[anime-hdr]

profile=anime-base
profile-restore=copy

osd-playing-msg=[HDR][Anime]: ${media-title}

# HDR handling
target-trc=pq
target-prim=bt.2020  
hdr-compute-peak=yes
hdr-peak-percentile=99.8
target-colorspace-hint=yes
icc-profile-auto=no						# Always OFF for HDR, I've had only troubles with this ON for HDR content


glsl-shader="~~/shaders/denoise3.glsl"	# Softens the shadows and adds a depth effect by blurring the background. I prefer it on, remove it if you don't like it.

#glsl-shader="~~/shaders/denoise1.glsl"	# If above one is too strong, you can try a weaker more subtle one. Uncomment this, and comment/remove the one above to try. 

###########################################################################

[anime-old]

profile=anime-base
profile-restore=copy

osd-playing-msg=[Legacy][Anime]: ${media-title}

glsl-shader="~~/shaders/denoise1.glsl"	# Softens the shadows and adds a depth effect by blurring the background. I prefer it on, remove it if you don't like it.

# 1) DEINTERLACE (PAL/NTSC true interlaced)
#   mode=1  -> spatial+temporal
#   parity=auto -> detects TFF/BFF
#   deint=all -> deinterlace all frames even if flags are wrong

vf=lavfi=[bwdif=mode=1:parity=auto:deint=all],@SVP:vapoursynth="~~/svp_main.vpy":buffered-frames=8:concurrent-frames=8

###########################################################################

[anime-sdr]

profile=anime-base
profile-restore=copy

osd-playing-msg=[Anime]: ${media-title}

glsl-shader="~~/shaders/denoise3.glsl"	# Softens the shadows and adds a depth effect by blurring the background. I prefer it on, remove it if you don't like it.

#glsl-shader="~~/shaders/denoise1.glsl"	# If above one is too strong, you can try a weaker more subtle one. Uncomment this, and comment/remove the one above to try. 

###########################################################################

[hdr]

profile=movies-tv
profile-restore=copy

osd-playing-msg=[HDR][üé¨]: ${media-title}

# HDR specific tweaks
target-trc=pq
target-prim=bt.2020
target-contrast=2500            # good for most HDR displays. Makes HDR look closer to SDR ‚Äúpunchy‚Äù without losing highlight rolloff.
hdr-compute-peak=yes            # analyze content for peak brightness
hdr-peak-percentile=99.8        # ignore extreme highlights
hdr-peak-decay-rate=20          # smooth peak detection. Smooths out frame-to-frame fluctuations.
hdr-contrast-recovery=0.3       # recover some contrast in shadows. If you find scenes still too dim, try 0.4‚Äì0.5. 
								# OLEDs benefit from it in real-world mixed light.
target-colorspace-hint=yes    	# prevent mis-mapping of HDR sources
icc-profile-auto=no				# Always OFF for HDR, I've had only troubles with this ON for HDR content

###########################################################################

[sdr]
 
profile=movies-tv
profile-restore=copy

osd-playing-msg=[üé¨]: ${media-title}

# SDR movies/TV profile
tone-mapping=bt.2446a        	# balanced, good highlight roll-off
tone-mapping-param=0.8       	# adjust highlight compression strength
 
# SDR movie enhancements
target-prim=auto 
target-trc=auto
contrast=7        				# more punch for cinematic content  
saturation=2     				# subtle color boost
gamma=0.93       				# lift shadows slightly
